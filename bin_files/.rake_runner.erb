#!/usr/bin/env ruby
#
# The application 'rake' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require 'rubygems'

<%
  bundled_rake = false
  if File.exists?('Gemfile.lock')
    # we assume bundler exists due to the Gemfile.lock
    rake_path = `bundle show rake`.chomp
    if rake_path =~ %r[/(gems/rake-.*$)]
      # found a bundled rake
      local_rake_path = $1
      bundled_rake = true
%>
# Using bundled rake
bundled_rake = "vendor/bundle/jruby/<%= @settings.ruby_version %>/<%= local_rake_path %>/lib"
$LOAD_PATH.unshift(File.expand_path(bundled_rake))

require 'rake'
Rake.application.run
  <% end %>
<% end %>

<% unless bundled_rake %>
# Using a fallback rake provided by rubygems
version = ">= 0"
gem 'rake', version
load Gem.bin_path('rake', 'rake', version)
<% end %>
